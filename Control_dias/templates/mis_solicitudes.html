{% extends "base.html" %}

{% block title %}Mis solicitudes{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Mis solicitudes</h2>

  <form method="get" class="d-flex align-items-center">
    <label for="anio" class="me-2 fw-semibold">Año</label>
    <select id="anio" name="anio" class="form-select form-select-sm" onchange="this.form.submit()">
      {% for y in available_years %}
        <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>
  </form>
</div>

{% if solicitudes %}
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Fecha solicitud</th>
          <th>Período / Fecha</th>
          <th class="text-end">Cantidad</th>
          <th>Estado</th>
          <th>Comentario admin</th>
        </tr>
      </thead>
      <tbody>
        {% for s in solicitudes %}
          <tr>
            <td>
              {% if s["request_type"] == "vacaciones" %}
                Vacaciones
              {% elif s["request_type"] == "administrativo" %}
                Día administrativo
              {% elif s["request_type"] == "horas_extras" %}
                Horas extras
              {% elif s["request_type"] == "horas_compensadas" %}
                Horas compensadas
              {% else %}
                {{ s["request_type"] }}
              {% endif %}
            </td>

            <td>
              {% if s["created_at"] %}
                {{ s["created_at"] | fecha }}
              {% else %}
                {{ s["start_date"] | fecha }}
              {% endif %}
            </td>


            <td>
              {% if s["end_date"] and s["end_date"] != s["start_date"] %}
                {{ s["start_date"] | fecha }} a {{ s["end_date"] | fecha }}
              {% else %}
                {{ s["start_date"] | fecha }}
              {% endif %}
            </td>


            <td class="text-end">
              {% if s["days"] is not none %}
                {% if s["request_type"] in ["horas_extras", "horas_compensadas"] %}
                  {{ s["days"] }} h
                {% else %}
                  {{ s["days"]|int }} d
                {% endif %}
              {% else %}
                -
              {% endif %}
            </td>

            <td>
              {% if s["status"] == "pendiente" %}
                <span class="badge text-bg-warning">Pendiente</span>
              {% elif s["status"] == "aprobada" %}
                <span class="badge text-bg-success">Aprobada</span>
              {% elif s["status"] == "rechazada" %}
                <span class="badge text-bg-danger">Rechazada</span>
              {% else %}
                <span class="badge text-bg-secondary">{{ s["status"] }}</span>
              {% endif %}
            </td>

            <td>
              {% if s["admin_comment"] %}
                <span class="text-muted">{{ s["admin_comment"] }}</span>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-secondary mb-0">
    No tienes solicitudes registradas para el año {{ selected_year }}.
  </div>
{% endif %}

{% endblock %}
